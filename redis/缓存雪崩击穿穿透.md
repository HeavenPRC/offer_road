## 缓存雪崩

指大量的应用请求无法再Redis缓存中进程处理，随之带来数据库压力激增

### 原因

##### 在某一时刻大量key ttl过期

![avatar](https://static001.geekbang.org/resource/image/74/2e/74bb1aa4b2213e3ff29e2ee701e8f72e.jpg)

解决方案：

1. 避免给同一批数据设置相同的过期时间
2. **服务降级**
   * 当业务应用访问的是非核心数据（例如电商商品属性）时，暂时停止从缓存中查询这些数据，而是直接返回预定义信息、空值或是错误信息；
   * 当业务应用访问的是核心数据（例如电商商品库存）时，仍然允许查询缓存，如果缓存缺失，也可以继续通过数据库读取。

##### Redis发生宕机

1. 在业务系统中实现服务熔断或请求限流机制

   * **服务熔断**：指在发生雪崩时，为了防止引发连锁的数据库雪崩，甚至整个系统的崩溃，暂停业务应用对缓存系统的访问接口。

     就是业务应用调用缓存接口时，缓存客户端并不把请求发给 Redis 缓存实例，而是**直接返回**，等到 Redis 缓存实例重新恢复服务后，再允许应用请求发送到缓存系统。这样可以避免大量请求因缓存缺失，而积压到数据库系统。保证了数据库系统的正常运行。

   * **请求限流**：一旦发生了缓存雪崩，数据库的每秒请求数突然增加到每秒 1 万个，此时，我们就可以启动请求限流机制，在请求入口前端只允许每秒进入系统的请求数为 1000 个，再多的请求就会在入口前端被直接拒绝服务。所以，使用了请求限流，就可以避免大量并发请求压力传递到数据库层。

2. 事前预防：构建主从高可靠集群

## 缓存击穿

针对某个访问非常频繁的热点数据的请求，无法在缓存中进行处理，访问数据的大量请求发送到了后端数据库，导致数据库压力激增。

常发生在热点数据缓存失效：设置不失效。。。。 =。=



## 缓存穿透

是指要访问的数据既不在Redis集群中，也不在数据库中，导致请求在访问缓存时，哪也没有。缓存和数据库就成了摆设，同时给缓存和数据库带来了压力。

1.缓存空值或者缺省值

2.使用布隆过滤器快速判断数据是否存在，避免从数据库中查询数据是否存在，减轻数据库压力。

mysql内置

布隆过滤器由一个初值都为 0 的 bit 数组和 N 个哈希函数组成，可以用来快速判断某个数据是否存在。

当我们想标记某个数据存在时（例如，数据已被写入数据库），布隆过滤器会通过三个操作完成标记：

* 首先，使用 N 个哈希函数，分别计算这个数据的哈希值，得到 N 个哈希值。
* 然后，我们把这 N 个哈希值对 bit 数组的长度取模，得到每个哈希值在数组中的对应位置。
* 最后，我们把对应位置的 bit 位设置为 1，这就完成了在布隆过滤器中标记数据的操作。
* 如果数据不存在（例如，数据库里没有写入数据），我们也就没有用布隆过滤器标记过数据，那么，bit 数组对应 bit 位的值仍然为 0。
* 当需要查询某个数据时，我们就执行刚刚说的计算过程，先得到这个数据在 bit 数组中对应的 N 个位置。紧接着，我们查看 bit 数组中这 N 个位置上的 bit 值。只要这 N 个 bit 值有一个不为 1，这就表明布隆过滤器没有对该数据做过标记，所以，查询的数据一定没有在数据库中保存。

3.前端对恶意请求进行过滤